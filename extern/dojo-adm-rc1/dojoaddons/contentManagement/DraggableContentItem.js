/*
	Copyright (c) 2004-2008, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/


if(!dojo._hasResource["dojoaddons.contentManagement.DraggableContentItem"]){dojo._hasResource["dojoaddons.contentManagement.DraggableContentItem"]=true;dojo.provide("dojoaddons.contentManagement.DraggableContentItem");dojo.require("dijit.TitlePane");dojo.declare("dojoaddons.contentManagement.DraggableContentItem",[dijit.TitlePane],{templateString:"<div class=\"${baseClass} draggableContentItem dojoDndItem\">\n\t<div dojoAttachEvent=\"onkeypress: _onTitleKey,onfocus:_handleFocus,onblur:_handleFocus\" tabindex=\"0\"\n\t\t\twaiRole=\"button\" class=\"dijitTitlePaneTitle dojoDndHandle\" dojoAttachPoint=\"titleBarNode,focusNode\">\n\t\t<div dojoAttachPoint=\"closeNode\" dojoAttachEvent=\"onclick:close\" class=\"dijitInline dijitCloseNode\"><span dojoAttachPoint=\"closeNodeInner\" class=\"dijitCloseNodeInner\"></span></div><div dojoAttachEvent=\"onclick:toggle\" dojoAttachPoint=\"arrowNode\" class=\"dijitInline dijitArrowNode\"><span dojoAttachPoint=\"arrowNodeInner\" class=\"dijitArrowNodeInner\"></span></div>\n\t\t<div dojoAttachPoint=\"titleNode\" class=\"dijitTitlePaneTextNode\"></div>\n\t</div>\n\t<div class=\"dijitTitlePaneContentOuter\" dojoAttachPoint=\"hideNode\">\n\t\t<div class=\"dijitReset\" dojoAttachPoint=\"wipeNode\">\n\t\t\t<div class=\"dijitTitlePaneContentInner\" dojoAttachPoint=\"containerNode\" waiRole=\"region\" tabindex=\"-1\">\n\t\t\t\t<!-- nested divs because wipeIn()/wipeOut() doesn't work right on node w/padding etc.  Put padding on inner div. -->\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n",type:"",staticContent:"",simpleId:"",helpUrl:"",helpText:"",lang:"",data:"",add:null,postCreate:function(){this.title=tools.lang.get("contentItem"+this.type+"Title");this.setTitle(this.title);this.simpleId=this.getSimpleId();if(!this.open){this.hideNode.style.display=this.wipeNode.style.display="none";}this._setCss();dojo.setSelectable(this.titleNode,false);this.inherited(arguments);dijit.setWaiState(this.containerNode,"labelledby",this.titleNode.id);dijit.setWaiState(this.focusNode,"haspopup","true");var _1=this.hideNode,_2=this.wipeNode;this._wipeIn=dojo.fx.wipeIn({node:this.wipeNode,duration:this.duration,beforeBegin:function(){_1.style.display="";}});this._wipeOut=dojo.fx.wipeOut({node:this.wipeNode,duration:this.duration,onEnd:function(){_1.style.display="none";}});this.setItemContent();},close:function(){tools.confirm({title:tools.lang.get("confirmContentDeletionTitle"),content:tools.lang.get("confirmContentDeletionContent"),callback:dojo.hitch(this,"destroyItem")});},destroyItem:function(){console.log("destroying: "+this.simpleId);dojo.publish("/contentManagement/itemDestroyed",[this.id,this.simpleId]);this.destroy();},setItemContent:function(){this.setContent(this.staticContent);},getSimpleId:function(){return this.id.substr(11)+"_"+this.lang;}});dojo.declare("dojoaddons.contentManagement.NonDraggableContentItem",[dojoaddons.contentManagement.DraggableContentItem],{templateString:"<div class=\"${baseClass} draggableContentItem\">\n\t<div dojoAttachEvent=\"onkeypress: _onTitleKey,onfocus:_handleFocus,onblur:_handleFocus\" tabindex=\"0\"\n\t\t\twaiRole=\"button\" class=\"dijitTitlePaneTitle\" dojoAttachPoint=\"titleBarNode,focusNode\">\n\t\t<div dojoAttachPoint=\"closeNode\" dojoAttachEvent=\"onclick:close\" class=\"dijitInline dijitCloseNode\"><span dojoAttachPoint=\"closeNodeInner\" class=\"dijitCloseNodeInner\"></span></div><div dojoAttachEvent=\"onclick:toggle\" dojoAttachPoint=\"arrowNode\" class=\"dijitInline dijitArrowNode\"><span dojoAttachPoint=\"arrowNodeInner\" class=\"dijitArrowNodeInner\"></span></div>\n\t\t<div dojoAttachPoint=\"titleNode\" class=\"dijitTitlePaneTextNode\"></div>\n\t</div>\n\t<div class=\"dijitTitlePaneContentOuter\" dojoAttachPoint=\"hideNode\">\n\t\t<div class=\"dijitReset\" dojoAttachPoint=\"wipeNode\">\n\t\t\t<div class=\"dijitTitlePaneContentInner\" dojoAttachPoint=\"containerNode\" waiRole=\"region\" tabindex=\"-1\">\n\t\t\t\t<!-- nested divs because wipeIn()/wipeOut() doesn't work right on node w/padding etc.  Put padding on inner div. -->\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n"});dojo.declare("dojoaddons.contentManagement.ModuleItem",[dojoaddons.contentManagement.DraggableContentItem],{type:"Module",moduleList:[],helpUrl:"",helpText:"",setItemContent:function(){this.moduleList=this.getModuleList();this.helpUrl=tools.lang.get("contentItemModuleHelpUrl");this.helpText=tools.lang.get("contentItemModuleHelpText");var c=this.getContent();this.setContent(c);var _4=this.simpleId+"_help";var tl=this.helpText;var tc=dojo.doc.createElement("div");tc.style.display="none";this.domNode.appendChild(tc);window.setTimeout(function(){var t=new dijit.Tooltip({connectId:[_4],label:tl},tc);},500);},getModuleList:function(){var _8=dojo.byId("moduleList_"+this.lang);var _9=[];dojo.forEach(_8.options,function(_a){if(_a.value!=="0"){_9.push({desc:_a.value,value:_a.value});}});return _9;},getContent:function(){var _b="<table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\">"+"<tbody><tr>"+"<th width=\"180\"><p>"+tools.lang.get("contentItemModuleLabel")+" </p></th>"+"<td width=\"100%\"><select class=\"input100\" name=\""+this.simpleId+"\" onchange=\"dojo.publish('/contentManagement/contentChanged');\">"+this.renderOptions()+"</select></td>"+"<td width=\"180\" nowrap=\"nowrap\">"+"<input type=\"checkbox\" name=\""+this.simpleId+"_rekursiv\" class=\"none\" "+(this.add&&this.add.rekursiv?"checked=\"checked\"":"")+" onchange=\"dojo.publish('/contentManagement/contentChanged');\"/>"+" "+tools.lang.get("contentItemApplyRecursive")+" </td>"+"<td><img onclick=\"openHelp('"+this.helpUrl+"');\" id=\""+this.simpleId+"_help\" alt=\"\" class=\"infoIcon\" src=\"../godot/backEnd/images_system/icons/info_icon.gif\"/></td>"+"</tr>"+"</tbody></table>";return _b;},renderOptions:function(){var _c="<option value=\"0\">----</option>";dojo.forEach(this.moduleList,function(_d){_c+=("<option value=\""+_d.value+"\" "+(this.data==_d.value?"selected=\"selected\"":"")+">"+_d.desc+"</option>");},this);return _c;}});dojo.declare("dojoaddons.contentManagement.BrickItem",[dojoaddons.contentManagement.DraggableContentItem],{type:"Brick",brickList:[],helpUrl:"",helpText:"",setItemContent:function(){this.helpUrl=tools.lang.get("contentItemBrickHelpUrl");this.helpText=tools.lang.get("contentItemBrickHelpText");this.brickList=this.getBrickList();var c=this.getContent();this.setContent(c);var _f=this.simpleId+"_help";var tl=this.helpText;var tc=dojo.doc.createElement("div");tc.style.display="none";this.domNode.appendChild(tc);window.setTimeout(function(){var t=new dijit.Tooltip({connectId:[_f],label:tl},tc);},0);},getBrickList:function(){var _13=dojo.byId("brickList_"+this.lang);var _14=[];dojo.forEach(_13.options,function(opt){if(opt.value!=="0"){_14.push({desc:opt.innerHTML,value:opt.value});}});return _14;},getContent:function(){var _16="<table width=\"100%\" cellspacing=\"0\" cellpadding=\"0\" border=\"0\">"+"<tbody><tr><th width=\"180\"><p>"+tools.lang.get("contentItemBrickLabel")+" </p></th>"+"<td width=\"100%\"><select class=\"input100\" name=\""+this.simpleId+"\" onchange=\"dojo.publish('/contentManagement/contentChanged');\">"+this.renderOptions()+"</select></td>"+"<td width=\"180\" nowrap=\"nowrap\">  <input type=\"checkbox\" name=\""+this.simpleId+"_rekursiv\" class=\"none\" "+(this.add&&this.add.rekursiv?"checked=\"checked\"":"")+" onchange=\"dojo.publish('/contentManagement/contentChanged');\"/> "+tools.lang.get("contentItemApplyRecursive")+"</td>"+"<td><img onclick=\"openHelp('"+this.helpUrl+"');\" id=\""+this.simpleId+"_help\" alt=\"\" class=\"infoIcon\" src=\"../godot/backEnd/images_system/icons/info_icon.gif\"/></td>"+"</tr></tbody></table>";return _16;},renderOptions:function(){var _17="<option value=\"0\">----</option>";dojo.forEach(this.brickList,function(_18){_17+=("<option value=\""+_18.value+"\" "+(this.data==_18.value?"selected=\"selected\"":"")+">"+_18.desc+"</option>");},this);return _17;}});dojo.declare("dojoaddons.contentManagement.TextItem",[dojoaddons.contentManagement.DraggableContentItem],{type:"Text",setItemContent:function(){var c=this.getContent(this.data);this.setContent(c);var id=this.simpleId;var _1b=this.data;dojo.addClass(this.domNode,"tinyMCEItem");window.setTimeout(function(){var ed=new tinymce.Editor(id,tinyConfig);tinyMCE.add(ed);ed.init();},0);},getContent:function(_1d){return "<textarea class=\"tinyArea\" style=\"width: 100%\" name=\""+this.simpleId+"\" id=\""+this.simpleId+"\">"+_1d+"</textarea>";}});dojo.declare("dojoaddons.contentManagement.TeaserItem",[dojoaddons.contentManagement.DraggableContentItem],{type:"Teaser",teaserList:[],helpUrl:"",helpText:"",teaserCount:0,setItemContent:function(){this.teaserList=this.getTeaserList();this.helpUrl=tools.lang.get("contentItemTeaserHelpUrl");this.helpText=tools.lang.get("contentItemTeaserHelpText");var c=this.getContent();this.setContent(c);var _1f=this.add||{"1":{data:"0"}};var _20=this;window.setTimeout(function(){for(var _21 in _1f){_20.addNewTeaser(_21,_1f[_21]);}},0);dojo.subscribe(this.simpleId+"_newTeaser",this,"addNewTeaser");dojo.subscribe(this.simpleId+"_deleteTeaser",this,"removeTeaser");var _22=this.simpleId+"_help";var tl=this.helpText;var tc=dojo.doc.createElement("div");tc.style.display="none";this.domNode.appendChild(tc);window.setTimeout(function(){var t=new dijit.Tooltip({connectId:[_22],label:tl},tc);},0);},getTeaserList:function(){var _26=dojo.byId("teaserList_"+this.lang);var _27=[];dojo.forEach(_26.options,function(opt){if(opt.value!=="0"){_27.push({desc:opt.innerHTML,value:opt.value});}});return _27;},getContent:function(){var _29="<table width=\"100%\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\">"+"<tr><th width=\"100\"><p>"+tools.lang.get("contentItemTeaserLabel")+"</p></th><td>"+"<div id=\""+this.simpleId+"_innerContainer\"></div>"+"</td></tr>"+"<tr><td></td><td><div class=\"addTeaserButton\" onclick=\"dojo.publish('"+this.simpleId+"_newTeaser');\">"+tools.lang.get("contentItemTeaserAdd")+"</div></td></table>";return _29;},getSingleTeaserContent:function(_2a,_2b){this.teaserCount++;var tc=dojo.doc.createElement("div");tc.id=this.simpleId+"_teaserTable_"+this.teaserCount;tc.innerHTML="<table width=\"99%\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">"+"<tr><td width=\"100%\"><select name=\""+this.simpleId+"_"+this.teaserCount+"\" class=\"input100\" onchange=\"dojo.publish('/contentManagement/contentChanged');\">"+this.renderOptions(_2b)+"</select></td><td>"+(this.teaserCount===1?"<div class=\"teaserDeleteButtonInvisible\"></div>":"<div class=\"teaserDeleteButton\" onclick=\"dojo.publish('"+this.simpleId+"_deleteTeaser',["+this.teaserCount+"]);\"></div>")+"</td>"+"<td width=\"180\" nowrap=\"nowrap\">&nbsp;<input type=\"checkbox\" class=\"none\" name=\""+this.simpleId+"_"+this.teaserCount+"_rekursiv\" "+(_2b&&_2b.rec?"checked=\"checked\"":"")+" onchange=\"dojo.publish('/contentManagement/contentChanged');\" /> "+tools.lang.get("contentItemApplyRecursive")+"</td>"+(this.teaserCount===1?"<td><img src=\"../godot/backEnd/images_system/icons/info_icon.gif\" class=\"infoIcon\" alt=\"\" id=\""+this.simpleId+"_help\" onclick=\"openHelp('"+this.helpUrl+"');\" /></td>":"<td><img src=\"../godot/backEnd/images_system/icons/info_icon_spacer.gif\" class=\"infoIcon\" title=\"\" alt=\"\" /></td>")+"</tr></table>";return tc;},renderOptions:function(_2d){var _2e="<option value=\"0\">----</option>";dojo.forEach(this.teaserList,function(_2f){_2e+=("<option value=\""+_2f.value+"\" "+(_2d&&_2d.data==_2f.value?"selected=\"selected\"":"")+">"+_2f.desc+"</option>");});return _2e;},addNewTeaser:function(_30,_31){var c=dojo.byId(this.simpleId+"_innerContainer").appendChild(this.getSingleTeaserContent(_30,_31));},removeTeaser:function(_33){dojo.byId(dojo.byId(this.simpleId+"_innerContainer")).removeChild(dojo.byId(this.simpleId+"_teaserTable_"+_33));}});}